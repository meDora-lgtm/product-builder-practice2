/**
 * i18n Translations
 */
const translations = {
  ko: {
    app_title: "World University Rankings 2025 Explorer",
    app_desc: "ì „ ì„¸ê³„ ìƒìœ„ 1000ê°œ ëª…ë¬¸ ëŒ€í•™êµì˜ ìµœì‹  ìˆœìœ„ì™€ ì„±ê³¼ ë°ì´í„°ë¥¼ ì‹¬ì¸µ ë¶„ì„í•˜ì—¬ êµìœ¡ì˜ ë¯¸ëž˜ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤.",
    btn_reload: "ë°ì´í„° ì—…ë°ì´íŠ¸",
    btn_reset: "í•„í„° ì´ˆê¸°í™”",
    btn_apply: "ìˆœìœ„ ì¡°íšŒ",
    filter_title: "ë°ì´í„° ë¶„ì„ ì¡°ê±´",
    shortcut_enter: "Enter ì¡°íšŒ",
    shortcut_search: "ê²€ìƒ‰ í¬ì»¤ìŠ¤",
    data_notice: "ë³¸ ì„œë¹„ìŠ¤ëŠ” ê¸€ë¡œë²Œ ëŒ€í•™ í‰ê°€ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì „ë¬¸ì ì¸ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ê³µì‹ íƒìƒ‰ í”Œëž«í¼ìž…ë‹ˆë‹¤.",
    label_search: "ëŒ€í•™êµ ê²€ìƒ‰",
    label_search_hint: "í•™êµëª… ë˜ëŠ” êµ­ê°€",
    label_year: "ë¶„ì„ ì—°ë„",
    label_year_hint: "ë°ì´í„° ê¸°ì¤€ ì—°ë„",
    label_country: "ì§€ì—­/êµ­ê°€",
    label_country_hint: "ì„ íƒ í•„í„°",
    label_sort: "ë°ì´í„° ì •ë ¬",
    label_sort_hint: "ì •ë ¬ ê¸°ì¤€ ì„ íƒ",
    label_page: "í‘œì‹œ ìˆ˜ëŸ‰",
    label_page_hint: "íŽ˜ì´ì§€ë‹¹ ê°œìˆ˜",
    label_current: "í™œì„± í•„í„°",
    label_current_hint: "í˜„ìž¬ ì ìš© ì¡°ê±´",
    msg_loading: "ìµœì‹  ëž­í‚¹ ë°ì´í„°ë¥¼ ë™ê¸°í™” ì¤‘ìž…ë‹ˆë‹¤â€¦",
    msg_wait: "ìž ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì‹­ì‹œì˜¤",
    source_credit: "ë°ì´í„° ì¶œì²˜: World University Rankings Official Dataset",
    result_title: "ë°ì´í„° ë¶„ì„ ê²°ê³¼",
    meta_year: "ì—°ë„",
    meta_shown: "ì¡°íšŒë¨",
    meta_total: "ì „ì²´",
    th_rank: "ì„¸ê³„ ìˆœìœ„",
    th_uni: "êµìœ¡ ê¸°ê´€",
    th_country: "ì†Œìž¬ êµ­ê°€",
    th_score: "ì¢…í•© ì ìˆ˜",
    msg_empty: "ì¡°ê±´ì— ë§žëŠ” ë°ì´í„°ê°€ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
    btn_prev: "ì´ì „ íŽ˜ì´ì§€",
    btn_next: "ë‹¤ìŒ íŽ˜ì´ì§€",
    page_label: "í˜„ìž¬ íŽ˜ì´ì§€",
    tip_prefix: "ë„ì›€ë§:",
    tip_suffix: "í‚¤ë¡œ ê²€ìƒ‰ì°½ ë°”ë¡œê°€ê¸°",
    footer_note: "* ë³¸ ë°ì´í„°ëŠ” ê³µì‹ ë ¥ ìžˆëŠ” ê¸°ê´€ì˜ ê³µê°œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ëœ ì „ë¬¸ ë¶„ì„ ë¦¬í¬íŠ¸ìž…ë‹ˆë‹¤.",
    opt_all: "ì „ì²´ ì§€ì—­",
    sort_rank_asc: "ìˆœìœ„ ë†’ì€ ìˆœ â†‘",
    sort_rank_desc: "ìˆœìœ„ ë‚®ì€ ìˆœ â†“",
    sort_score_desc: "ì ìˆ˜ ë†’ì€ ìˆœ â†“",
    sort_name_asc: "í•™êµëª… ê°€ë‚˜ë‹¤ìˆœ",
    msg_data_ready: "ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ",
    msg_render: "ë°ì´í„° ì‹œê°í™” ì¤‘â€¦",
    national_rank: "êµ­ê°€ë³„ ìˆœìœ„",
    label_partnership: "í•™ìˆ  ë° ë¹„ì¦ˆë‹ˆìŠ¤ ì œíœ´ ë¬¸ì˜",
    label_partnership_hint: "ê³µì‹ íŒŒíŠ¸ë„ˆì‹­",
    placeholder_name: "ì„±í•¨ ë˜ëŠ” ê¸°ê´€ëª…",
    placeholder_email: "íšŒì‹  ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œ",
    placeholder_message: "ë¬¸ì˜í•˜ì‹œê³ ìž í•˜ëŠ” ìƒì„¸ ë‚´ìš©ì„ ìž…ë ¥í•´ ì£¼ì‹­ì‹œì˜¤",
    btn_send: "ë¬¸ì˜ ì ‘ìˆ˜",
    comments_title: "ê¸€ë¡œë²Œ í•™ìˆ  ì»¤ë®¤ë‹ˆí‹°",
    label_ads: "í›„ì› ê´‘ê³ ",
    about_title: "ì„¸ê³„ ëª…ë¬¸ëŒ€ ì¸ì‚¬ì´íŠ¸ ë° ê¸€ë¡œë²Œ í•™ìˆ  ì •ë³´ ê°€ì´ë“œ",
    about_desc: "ë³¸ í”Œëž«í¼ì€ ì „ ì„¸ê³„ ê³ ë“±êµìœ¡ ê¸°ê´€ì˜ í•™ìˆ ì  ì„±ê³¼, ì—°êµ¬ ì—­ëŸ‰, ê·¸ë¦¬ê³  ê¸€ë¡œë²Œ í‰íŒì„ ìž…ì²´ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ì œê³µí•˜ëŠ” ì „ë¬¸ ë°ì´í„° í—ˆë¸Œìž…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” í•™ìƒ, ì—°êµ¬ìž, ê·¸ë¦¬ê³  êµìœ¡ ì „ë¬¸ê°€ë“¤ì´ ì‹ ë¢°í•  ìˆ˜ ìžˆëŠ” ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìµœì ì˜ ì˜ì‚¬ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìžˆë„ë¡ ë•ìŠµë‹ˆë‹¤. ë§¤ë…„ ì—…ë°ì´íŠ¸ë˜ëŠ” ìµœì‹  ë°ì´í„°ë¥¼ í†µí•´ ê¸€ë¡œë²Œ êµìœ¡ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•˜ê³ , ê° ëŒ€í•™ì˜ í•µì‹¬ ê²½ìŸë ¥ì„ ë¹„êµ ë¶„ì„í•  ìˆ˜ ìžˆëŠ” í™˜ê²½ì„ êµ¬ì¶•í•˜ê³  ìžˆìŠµë‹ˆë‹¤. ë³¸ ì„œë¹„ìŠ¤ëŠ” êµìœ¡ì˜ ì§ˆ í–¥ìƒê³¼ ê¸€ë¡œë²Œ í•™ìˆ  êµë¥˜ì˜ í™œì„±í™”ë¥¼ ëª©í‘œë¡œ ìš´ì˜ë©ë‹ˆë‹¤.",
    policy_privacy: "ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨",
    policy_terms: "ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€",
    privacy_content: "World Uni ExplorerëŠ” ì‚¬ìš©ìžì˜ ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ìƒê°í•©ë‹ˆë‹¤. ë³¸ ì„œë¹„ìŠ¤ëŠ” ê°œì¸ì„ ì‹ë³„í•  ìˆ˜ ìžˆëŠ” ì •ë³´ë¥¼ ì§ì ‘ ìˆ˜ì§‘í•˜ê±°ë‚˜ ì €ìž¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ì‚¬ìš©ìž ê²½í—˜ ê°œì„  ë° ì„œë¹„ìŠ¤ ë¶„ì„ì„ ìœ„í•´ Google Analyticsì™€ ê°™ì€ ë„êµ¬ë¥¼ í™œìš©í•  ìˆ˜ ìžˆìœ¼ë©°, Google AdSenseë¥¼ í†µí•´ ë§žì¶¤í˜• ê´‘ê³ ë¥¼ ì œê³µí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìžëŠ” ë¸Œë¼ìš°ì € ì„¤ì •ì„ í†µí•´ ì¿ í‚¤ ìˆ˜ì§‘ì„ ê±°ë¶€í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ìžì„¸í•œ ì •ë³´ëŠ” Googleì˜ ê°œì¸ì •ë³´ ë³´í˜¸ì •ì±…ì„ ì°¸ì¡°í•´ ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤.",
    terms_content: "ë³¸ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ëª¨ë“  ë°ì´í„°ëŠ” ì‹ ë¢°í•  ìˆ˜ ìžˆëŠ” ê³µê°œ ìžë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë‚˜, ì‹¤ì œ ìˆ˜ì¹˜ëŠ” ê° êµìœ¡ ê¸°ê´€ì˜ ê³µì‹ ë°œí‘œì™€ ì°¨ì´ê°€ ìžˆì„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ì œê³µë˜ëŠ” ì •ë³´ëŠ” ì°¸ê³ ìš©ì´ë©°, ìµœì¢…ì ì¸ ìž…í•™ ë˜ëŠ” í•™ìˆ ì  ê²°ì •ì— ëŒ€í•œ ì±…ìž„ì€ ì‚¬ìš©ìž ë³¸ì¸ì—ê²Œ ìžˆìŠµë‹ˆë‹¤. ë¬´ë‹¨ ë°ì´í„° í¬ë¡¤ë§ì´ë‚˜ ì„œë¹„ìŠ¤ ìš´ì˜ì„ ë°©í•´í•˜ëŠ” í–‰ìœ„ëŠ” ì œí•œë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ìµœì‹  ì •ë³´ í™•ì¸ì„ ìœ„í•´ ì •ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ìžˆìœ¼ë‚˜, ê°€ìž¥ ì •í™•í•œ ìˆ˜ì¹˜ëŠ” í•´ë‹¹ ëŒ€í•™ì˜ ê³µì‹ í™ˆíŽ˜ì´ì§€ë¥¼ í†µí•´ í™•ì¸í•˜ì‹œê¸°ë¥¼ ê¶Œìž¥í•©ë‹ˆë‹¤.",
    copyright: "Â© 2026 World Uni Explorer. Leading Global Education Insights.",
    btn_close: "í™•ì¸ ë° ë‹«ê¸°",
    podium_title: "Global Top 3 ëª…ì˜ˆì˜ ì „ë‹¹",
    rising_stars_title: "í˜ì‹ ì  ì„±ìž¥ì„ ê¸°ë¡í•œ ë¼ì´ì§• ìŠ¤íƒ€",
    rank_up: "ê³„ë‹¨ ìƒìŠ¹"
  },
  en: {
    app_title: "QS World University Rankings 2025 Explorer",
    app_desc: "Explore top universities worldwide based on the latest QS 2025 data.",
    btn_reload: "Sync Data",
    btn_reset: "Reset",
    btn_apply: "Search",
    filter_title: "Filters",
    shortcut_enter: "Press Enter",
    shortcut_search: "Focus search",
    data_notice: "Based on official QS World University Rankings 2025 data.",
    label_search: "Search",
    label_search_hint: "Name/Country",
    label_year: "Year",
    label_year_hint: "Data Year",
    label_country: "Country",
    label_country_hint: "Select",
    label_sort: "Sort",
    label_sort_hint: "Default: World Rank",
    label_page: "Show",
    label_page_hint: "Per Page",
    label_current: "Conditions",
    label_current_hint: "Summary",
    msg_loading: "Loading rankings...",
    msg_wait: "Please wait a moment",
    source_credit: "Source: QS World University Rankings 2025",
    result_title: "Results",
    meta_year: "Year",
    meta_shown: "Shown",
    meta_total: "Total",
    th_rank: "World Rank",
    th_uni: "University",
    th_country: "Country",
    th_score: "Score",
    msg_empty: "No results found.",
    btn_prev: "Prev",
    btn_next: "Next",
    page_label: "Page",
    tip_prefix: "Tip:",
    tip_suffix: "to focus search",
    footer_note: "* Visualized dashboard based on official QS data.",
    opt_all: "All",
    sort_rank_asc: "Rank Asc",
    sort_rank_desc: "Rank Desc",
    sort_score_desc: "Score Desc",
    sort_name_asc: "Name A-Z",
    msg_data_ready: "Rankings Ready",
    msg_render: "Visualizing...",
    national_rank: "National rank",
    label_partnership: "Partnership",
    label_partnership_hint: "Formspree",
    placeholder_name: "Name / Company",
    placeholder_email: "Email Address",
    placeholder_message: "Enter your message",
    btn_send: "Send",
    comments_title: "Community",
    label_ads: "AD",
    about_title: "World University Insights Hub",
    about_desc: "Dedicated to facilitate exploration of global higher education. We provide intuitive data tools to help users access academic rankings and institutional performance worldwide.",
    policy_privacy: "Privacy Policy",
    policy_terms: "Terms of Service",
    privacy_content: "We do not collect personal data. Cookies from third parties like Google AdSense are used for ad personalization.",
    terms_content: "Data provided is for informational purposes only. While we strive for accuracy, please verify with official sources for definitively up-to-date information.",
    copyright: "Â© 2026 World Uni Explorer. Empowering Global Education.",
    btn_close: "Close",
    podium_title: "Hall of Fame: Top 3",
    rising_stars_title: "Rising Stars (Last 3 Years)",
    rank_up: "ranks up"
  },
  ja: {
    app_title: "QS ä¸–ç•Œå¤§å­¦ãƒ©ãƒ³ã‚­ãƒ³ã‚° 2025 ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼",
    app_desc: "æœ€æ–°ã® QS 2025 ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã€ä¸–ç•Œä¸­ã®å¤§å­¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æŽ¢ç´¢ã—ã¾ã™ã€‚",
    btn_reload: "æ›´æ–°",
    btn_reset: "ãƒªã‚»ãƒƒãƒˆ",
    btn_apply: "æ¤œç´¢",
    filter_title: "ç…§ä¼šæ¡ä»¶",
    shortcut_enter: "Enter",
    shortcut_search: "æ¤œç´¢ãƒ•ã‚©ãƒ¼ã‚«ã‚¹",
    data_notice: "å…¬å¼ QS World University Rankings 2025 ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚",
    label_search: "æ¤œç´¢",
    label_search_hint: "å¤§å­¦å/å›½å",
    label_year: "å¹´åº¦",
    label_year_hint: "ãƒ‡ãƒ¼ã‚¿å¹´åº¦",
    label_country: "å›½",
    label_country_hint: "é¸æŠž",
    label_sort: "ä¸¦ã³æ›¿ãˆ",
    label_sort_hint: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ä¸–ç•Œé †ä½",
    label_page: "è¡¨ç¤ºä»¶æ•°",
    label_page_hint: "ãƒšãƒ¼ã‚¸ã‚ãŸã‚Š",
    label_current: "æ¡ä»¶",
    label_current_hint: "è¦ç´„",
    msg_loading: "ãƒ­ãƒ¼ãƒ‰ä¸­...",
    msg_wait: "ãŠå¾…ã¡ãã ã•ã„",
    source_credit: "å‡ºå…¸: QS World University Rankings 2025",
    result_title: "çµæžœ",
    meta_year: "å¹´åº¦",
    meta_shown: "è¡¨ç¤ºä¸­",
    meta_total: "å…¨ä½“",
    th_rank: "ä¸–ç•Œé †ä½",
    th_uni: "å¤§å­¦",
    th_country: "å›½",
    th_score: "ã‚¹ã‚³ã‚¢",
    msg_empty: "è©²å½“ã™ã‚‹çµæžœãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
    btn_prev: "å‰ã¸",
    btn_next: "æ¬¡ã¸",
    page_label: "ãƒšãƒ¼ã‚¸",
    tip_prefix: "Tip:",
    tip_suffix: "ã§æ¤œç´¢çª“ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹",
    footer_note: "* å…¬å¼ QS ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸå¯è¦–åŒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã™ã€‚",
    opt_all: "ã™ã¹ã¦",
    sort_rank_asc: "ä¸–ç•Œé †ä½ â†‘",
    sort_rank_desc: "ä¸–ç•Œé †ä½ â†“",
    sort_score_desc: "ã‚¹ã‚³ã‚¢ â†“",
    sort_name_asc: "å¤§å­¦å Aâ†’Z",
    msg_data_ready: "æº–å‚™å®Œäº†",
    msg_render: "å¯è¦–åŒ–ä¸­...",
    national_rank: "å›½å†…é †ä½",
    label_partnership: "ææºãŠå•ã„åˆã‚ã›",
    label_partnership_hint: "Formspree",
    placeholder_name: "ãŠåå‰ / ä¼æ¥­å",
    placeholder_email: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
    placeholder_message: "ãŠå•ã„åˆã‚ã›å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
    btn_send: "é€ä¿¡",
    comments_title: "ã‚³ãƒ¡ãƒ³ãƒˆ",
    label_ads: "åºƒå‘Š",
    about_title: "ä¸–ç•Œåé–€å¤§å­¦ç´¹ä»‹ãŠã‚ˆã³ç…§ä¼šãƒãƒ–",
    about_desc: "ä¸–ç•Œä¸­ã®æœ‰åãªå¤§å­¦ã®ç´¹ä»‹ã¨ç…§ä¼šã‚’ã‚ˆã‚Šå††æ»‘ã«ã™ã‚‹ãŸã‚ã«æ§‹ç¯‰ã•ã‚Œã¾ã—ãŸã€‚QSã®ãƒ‡ãƒ¼ã‚¿ã‚’åŸºã«ã€ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯ãƒˆãƒ¬ãƒ³ãƒ‰ã‚„ç«¶äº‰åŠ›ã‚’åˆ†æžã§ãã‚‹ç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚",
    policy_privacy: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼",
    policy_terms: "åˆ©ç”¨è¦ç´„",
    privacy_content: "å½“ã‚µã‚¤ãƒˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ã‚’ç›´æŽ¥åŽé›†ã—ã¾ã›ã‚“ã€‚åºƒå‘Šãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã®ãŸã‚ã«ã‚¯ãƒƒã‚­ãƒ¼ãŒä½¿ç”¨ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
    terms_content: "æä¾›ã•ã‚Œã‚‹å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯å‚ç…§ç”¨ã§ã™ã€‚æœ€æ–°ã®å…¬å¼æƒ…å ±ã‚’å¿…ãšç¢ºèªã—ã¦ãã ã•ã„ã€‚",
    copyright: "Â© 2026 World Uni Explorer. Empowering Global Education.",
    btn_close: "é–‰ã˜ã‚‹",
    podium_title: "æ „èª‰ã®æ®¿å ‚: TOP 3",
    rising_stars_title: "ë¼ì´ì§•ìŠ¤íƒ€ (ç›´è¿‘3å¹´)",
    rank_up: "ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—"
  }
};

const $ = (s) => document.querySelector(s);

function setLanguage(lang) {
  const dict = translations[lang] || translations.en;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (dict[key]) {
      if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") {
        el.placeholder = dict[key];
      } else {
        el.textContent = dict[key];
      }
    }
  });
  localStorage.setItem("lang", lang);
  $("#langSelect").value = lang;
}

$("#langSelect").addEventListener("change", (e) => {
  setLanguage(e.target.value);
  buildCountries();
  render();
  renderRisingStars();
});

const QS_DATA_2025 = [
  {rank:1, name:"Massachusetts Institute of Technology (MIT)", country:"United States", score:100, year:2025},
  {rank:2, name:"Imperial College London", country:"United Kingdom", score:98.5, year:2025},
  {rank:3, name:"University of Oxford", country:"United Kingdom", score:96.9, year:2025},
  {rank:4, name:"Harvard University", country:"United States", score:96.8, year:2025},
  {rank:5, name:"University of Cambridge", country:"United Kingdom", score:96.7, year:2025},
  {rank:6, name:"Stanford University", country:"United States", score:96.1, year:2025},
  {rank:7, name:"ETH Zurich", country:"Switzerland", score:93.9, year:2025},
  {rank:8, name:"National University of Singapore (NUS)", country:"Singapore", score:93.7, year:2025},
  {rank:9, name:"UCL", country:"United Kingdom", score:91.6, year:2025},
  {rank:10, name:"California Institute of Technology (Caltech)", country:"United States", score:90.9, year:2025},
  {rank:11, name:"University of Pennsylvania", country:"United States", score:90.3, year:2025},
  {rank:12, name:"University of California, Berkeley (UCB)", country:"United States", score:90.1, year:2025},
  {rank:13, name:"University of Melbourne", country:"Australia", score:88.9, year:2025},
  {rank:14, name:"Peking University", country:"China", score:88.5, year:2025},
  {rank:15, name:"Nanyang Technological University (NTU)", country:"Singapore", score:88.4, year:2025},
  {rank:16, name:"Cornell University", country:"United States", score:87.9, year:2025},
  {rank:17, name:"The University of Hong Kong (HKU)", country:"Hong Kong", score:87.6, year:2025},
  {rank:18, name:"The University of Sydney", country:"Australia", score:87.3, year:2025},
  {rank:19, name:"The University of New South Wales (UNSW)", country:"Australia", score:87.1, year:2025},
  {rank:20, name:"Tsinghua University", country:"China", score:86.5, year:2025},
  {rank:31, name:"Seoul National University (SNU)", country:"South Korea", score:82.4, year:2025},
  {rank:53, name:"KAIST", country:"South Korea", score:75.1, year:2025},
  {rank:67, name:"Yonsei University", country:"South Korea", score:70.2, year:2025},
  {rank:102, name:"Korea University", country:"South Korea", score:62.1, year:2025},
  {rank:32, name:"University of Tokyo", country:"Japan", score:82.1, year:2025},
  {rank:45, name:"Kyoto University", country:"Japan", score:78.4, year:2025},
  {rank:84, name:"Osaka University", country:"Japan", score:66.5, year:2025}
];

const state = {
  raw: QS_DATA_2025,
  year: 2025,
  q: "",
  country: "__ALL__",
  sort: "rank_asc",
  page: 1,
  pageSize: 50
};

function setSourceStatus(loaded, msg){
  const box = $("#sourceBox");
  const lang = localStorage.getItem("lang") || "ko";
  const dict = translations[lang];
  box.innerHTML = loaded
    ? `<div class="dot" style="animation:none; opacity:1;"></div>
       <div>
         <div style="color:var(--text); opacity:0.9; font-size:13px; font-weight:650;">${dict.msg_data_ready}</div>
         <div style="font-size:12px;">${msg}</div>
       </div>`
    : `<div class="dot"></div>
       <div>
         <div style="color:var(--text); opacity:0.86; font-size:13px; font-weight:650;">${dict.msg_loading}</div>
         <div style="font-size:12px;">${msg || dict.msg_wait}</div>
       </div>`;
}

function normalize(s){ return (s || "").toLowerCase().trim(); }
function uniq(arr){ return [...new Set(arr)]; }

function buildYears(){
  const sel = $("#year");
  sel.innerHTML = `<option value="2025">2025</option>`;
  state.year = 2025;
}

function buildCountries(){
  const list = state.raw.map(x => x.country).filter(Boolean);
  const countries = uniq(list).sort((a,b)=>a.localeCompare(b));
  const sel = $("#country");
  const lang = localStorage.getItem("lang") || "ko";
  const allText = translations[lang].opt_all;
  sel.innerHTML = `<option value="__ALL__">${allText}</option>`;
  countries.forEach(c=>{
    const opt = document.createElement("option");
    opt.value = c;
    opt.textContent = c;
    sel.appendChild(opt);
  });
}

function updateSummary(){
  const chips = $("#summaryChips");
  const lang = localStorage.getItem("lang") || "ko";
  const dict = translations[lang];
  const parts = [];
  if (state.year) parts.push({k:dict.label_year, v:String(state.year)});
  if (state.country !== "__ALL__") parts.push({k:dict.label_country, v:state.country});
  if (state.q) parts.push({k:dict.label_search, v:state.q});
  parts.push({k:dict.label_sort, v: $("#sort").selectedOptions[0].textContent});
  chips.innerHTML = "";
  parts.forEach(p=>{
    const d = document.createElement("div");
    d.className = "chip";
    d.textContent = `${p.k}: ${p.v}`;
    chips.appendChild(d);
  });
}

function applyFilters(){
  const q = normalize(state.q);
  let list = [...state.raw];
  if (state.country !== "__ALL__") list = list.filter(x => x.country === state.country);
  if (q) list = list.filter(x => normalize(`${x.name} ${x.country}`).includes(q));
  if (state.sort === "rank_asc") list.sort((a,b)=>a.rank - b.rank);
  else if (state.sort === "rank_desc") list.sort((a,b)=>b.rank - a.rank);
  else if (state.sort === "score_desc") list.sort((a,b)=>(b.score ?? -1) - (a.score ?? -1));
  else if (state.sort === "name_asc") list.sort((a,b)=>String(a.name).localeCompare(String(b.name)));
  return list;
}

function renderPodium() {
  const podium = $("#podium");
  if (!podium) return;
  const top3 = [...QS_DATA_2025].sort((a,b)=>a.rank - b.rank).slice(0,3);
  const order = [1, 0, 2]; // 2nd, 1st, 3rd visually
  const characters = {
    1: { emoji: "ðŸŽ“ðŸ¤–", color: "linear-gradient(135deg, #A31F34, #000)", title: "MIT" },
    2: { emoji: "ðŸ›¡ï¸ðŸ”¬", color: "linear-gradient(135deg, #003D71, #000)", title: "Imperial" },
    3: { emoji: "ðŸ“–ðŸ“˜", color: "linear-gradient(135deg, #002147, #000)", title: "Oxford" }
  };
  podium.innerHTML = order.map(idx => {
    const uni = top3[idx];
    const char = characters[uni.rank];
    return `
      <div class="podium-step step-${uni.rank}">
        <div class="uni-char" style="background: ${char.color};" title="${uni.name}">
          <span class="emoji">${char.emoji}</span>
        </div>
        <div class="step-block">
          <span class="podium-rank">${uni.rank}</span>
        </div>
        <div class="uni-label">${uni.name.split('(')[0]}</div>
      </div>
    `;
  }).join('');
}

function renderRisingStars() {
  const container = $("#risingStars");
  if (!container) return;
  const lang = localStorage.getItem("lang") || "ko";
  const dict = translations[lang];
  const stars = [
    { name: "University of Melbourne", gain: 20, from: 33, to: 13, year: "2023-2025" },
    { name: "KAIST", gain: 18, from: 71, to: 53, year: "2023-2025" },
    { name: "Nanyang Technological University (NTU)", gain: 11, from: 26, to: 15, year: "2023-2025" }
  ];
  container.innerHTML = stars.map(s => `
    <div class="star-card">
      <div class="star-info">
        <strong>${s.name}</strong>
        <div style="font-size:12px; color:var(--muted2); margin-top:4px;">${s.year}</div>
      </div>
      <div class="star-gain">
        <span class="gain-badge">+${s.gain} ${dict.rank_up}</span>
        <div style="font-size:11px; margin-top:4px;">Rank ${s.from} â†’ ${s.to}</div>
      </div>
    </div>
  `).join('');
}

function render(){
  const lang = localStorage.getItem("lang") || "ko";
  const dict = translations[lang];
  $("#loadingArea").style.display = "block";
  $("#empty").style.display = "none";
  $("#tbody").innerHTML = "";
  const list = applyFilters();
  const total = list.length;
  const maxPage = Math.max(1, Math.ceil(total / state.pageSize));
  state.page = Math.min(state.page, maxPage);
  const start = (state.page - 1) * state.pageSize;
  const pageItems = list.slice(start, state.page * state.pageSize);
  $("#pageNow").textContent = String(state.page);
  $("#pageMax").textContent = String(maxPage);
  $("#metaYear").textContent = "2025";
  $("#metaTotal").textContent = String(total);
  $("#metaShown").textContent = String(pageItems.length);
  $("#metaCount").textContent = `${dict.result_title} ${total.toLocaleString()}`;
  $("#resultTitle").textContent = `QS World Rankings 2025`;
  if (!pageItems.length){
    $("#loadingArea").style.display = "none";
    $("#empty").style.display = "block";
    return;
  }
  const tbody = $("#tbody");
  pageItems.forEach(it => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><span class="rank">#${it.rank}</span></td>
      <td><div style="font-weight:650; color:var(--text);">${escapeHTML(it.name)}</div></td>
      <td><span class="pill"><b>${escapeHTML(it.country)}</b></span></td>
      <td><span class="pill"><b>${it.score}</b></span></td>
    `;
    tbody.appendChild(tr);
  });
  $("#loadingArea").style.display = "none";
  updateSummary();
  renderPodium();
}

function escapeHTML(s){ return String(s ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"); }

async function loadData(){
  buildYears();
  buildCountries();
  setSourceStatus(true, `QS 2025 ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ`);
  render();
  renderRisingStars();
}

$("#btnApply").addEventListener("click", ()=>{ state.page = 1; render(); });
$("#btnReset").addEventListener("click", ()=>{
  state.q = ""; state.country = "__ALL__"; state.sort = "rank_asc"; state.page = 1;
  $("#q").value = ""; $("#country").value = "__ALL__"; $("#sort").value = "rank_asc";
  render();
});
$("#btnReload").addEventListener("click", loadData);
$("#q").addEventListener("input", (e)=>{ state.q = e.target.value; });
$("#q").addEventListener("keydown", (e)=>{ if (e.key === "Enter") { state.page = 1; render(); } });
$("#country").addEventListener("change", (e)=>{ state.country = e.target.value; state.page = 1; render(); });
$("#sort").addEventListener("change", (e)=>{ state.sort = e.target.value; state.page = 1; render(); });
$("#prev").addEventListener("click", ()=>{ state.page = Math.max(1, state.page - 1); render(); });
$("#next").addEventListener("click", ()=>{ state.page++; render(); });

window.addEventListener("keydown", (e)=>{
  if (e.key === "/" && document.activeElement?.tagName !== "INPUT"){
    e.preventDefault(); $("#q").focus();
  }
});

const themeToggle = $("#themeToggle");
const themeIcon = $("#themeIcon");
function setTheme(theme) {
  document.documentElement.setAttribute("data-theme", theme);
  localStorage.setItem("theme", theme);
  themeIcon.textContent = theme === "dark" ? "ðŸŒ™" : "â˜€ï¸";
}
themeToggle.addEventListener("click", () => {
  const currentTheme = document.documentElement.getAttribute("data-theme") || "dark";
  setTheme(currentTheme === "dark" ? "light" : "dark");
});

setTheme(localStorage.getItem("theme") || "dark");
setLanguage(localStorage.getItem("lang") || "ko");
loadData();

/** Modal Logic */
function openModal(type) {
  const dict = translations[localStorage.getItem("lang") || "ko"];
  $("#modalTitle").textContent = type === "privacy" ? dict.policy_privacy : dict.policy_terms;
  $("#modalBody").textContent = type === "privacy" ? dict.privacy_content : dict.terms_content;
  $("#modalOverlay").classList.add("active");
  $("#modalContent").classList.add("active");
  document.body.style.overflow = "hidden";
}
function closeModal() {
  $("#modalOverlay").classList.remove("active");
  $("#modalContent").classList.remove("active");
  document.body.style.overflow = "";
}
$("#openPrivacy").addEventListener("click", () => openModal("privacy"));
$("#openTerms").addEventListener("click", () => openModal("terms"));
$("#closeModal").addEventListener("click", closeModal);
$("#modalOverlay").addEventListener("click", closeModal);
$("#btnModalClose").addEventListener("click", closeModal);
